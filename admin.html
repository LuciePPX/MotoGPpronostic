<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Admin - R√©sultats MotoGP</title>
<link rel="stylesheet" href="./style.css">
<style>
body { font-family: 'Oswald', sans-serif; background:#1a1a1a; color:white; display:flex; justify-content:center; align-items:center; min-height:100vh; }
.admin-box { width:100%; max-width:500px; padding:30px; background:rgba(0,0,0,0.9); border-radius:15px; border:2px solid #e10600; }
input, select, button { width:100%; padding:10px; margin-top:5px; }
.grid-admin { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.btn-valider { background:#e10600; color:white; border:none; cursor:pointer; margin-top:15px; }
</style>
</head>

<body>
<div class="admin-box">
<h1>üèÜ R√©sultats</h1>

<label>Mot de passe</label>
<input type="password" id="admin-pass">

<label>Session</label>
<select id="type-session">
<option value="Sprint">Sprint</option>
<option value="Race">Race</option>
</select>

<div class="grid-admin">
<div>
<label>ü•á 1er</label>
<select id="res-1"></select>
</div>
<div>
<label>ü•à 2e</label>
<select id="res-2"></select>
</div>
<div>
<label>ü•â 3e</label>
<select id="res-3"></select>
</div>
<div>
<label>‚ö†Ô∏è Chute(s)</label>
<div id="crash-selects-container">
<select class="res-chute"></select>
</div>
<button id="add-crash" type="button">+ Ajouter une chute</button>
</div>
</div>

<button id="btn-publier" class="btn-valider">Publier</button>
<p id="status-msg"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { DATA_PILOTES } from "./config.js";

const firebaseConfig = {
 apiKey: "AIzaSyAlWxI_w2R6eyJYBg9h_ynHWAgz3VS51Zk",
 authDomain: "motogppronostic.firebaseapp.com",
 databaseURL: "https://motogppronostic-default-rtdb.europe-west1.firebasedatabase.app",
 projectId: "motogppronostic"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== Remplir menus =====
function remplirSelect(select) {
 select.innerHTML = `<option value="">-- Choisir --</option>`;
 const pilotes = [...DATA_PILOTES].sort((a,b)=>a.nom.localeCompare(b.nom));
 pilotes.forEach(p=>{
  const opt=document.createElement("option");
  opt.value=p.num;
  opt.textContent=`#${p.num} - ${p.nom}`;
  select.appendChild(opt);
 });
}

["res-1","res-2","res-3"].forEach(id=>{
 remplirSelect(document.getElementById(id));
});
remplirSelect(document.querySelector(".res-chute"));

// ===== Ajouter chute =====
document.getElementById("add-crash").onclick=()=>{
 const sel=document.createElement("select");
 sel.className="res-chute";
 remplirSelect(sel);
 document.getElementById("crash-selects-container").appendChild(sel);
};

// ===== Publier =====
document.getElementById("btn-publier").onclick=async()=>{
 const pass=document.getElementById("admin-pass").value;
 if(pass!=="1234") return alert("Mot de passe incorrect");

 const session=document.getElementById("type-session").value;

 const chutes=[...document.querySelectorAll(".res-chute")]
   .map(s=>parseInt(s.value))
   .filter(v=>!isNaN(v));

 const results={
  "1er":parseInt(document.getElementById("res-1").value),
  "2e":parseInt(document.getElementById("res-2").value),
  "3e":parseInt(document.getElementById("res-3").value),
  "Chute":chutes,
  "timestamp":new Date().toISOString()
 };

 if(!results["1er"]) return alert("Choisis au moins le vainqueur");

 const raceName="currentRace"; // √† adapter plus tard avec ton calendrier
 await set(ref(db,`resultats/${session}/${raceName}`),results);

 document.getElementById("status-msg").textContent="‚úÖ R√©sultats publi√©s";
};
</script>
</body>
</html>