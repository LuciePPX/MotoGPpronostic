<script type="module">
    // Import des outils Firebase et de vos données/fonctions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { DATA_PILOTES } from "./config.js"; // On importe la liste des pilotes

    const firebaseConfig = {
        apiKey: "AIzaSyAlWxI_w2R6eyJYBg9h_ynHWAgz3VS51Zk",
        authDomain: "motogppronostic.firebaseapp.com",
        databaseURL: "https://motogppronostic-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "motogppronostic"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- FONCTION POUR REMPLIR LES LISTES ---
    function remplirMenusAdmin() {
        const selects = ["res-1", "res-2", "res-3", "res-chute"];
        const pilotesTries = [...DATA_PILOTES].sort((a, b) => a.nom.localeCompare(b.nom));

        selects.forEach(id => {
            const selectEl = document.getElementById(id);
            if (selectEl) {
                // On garde la première option (titre) et on ajoute les pilotes
                const defaultText = selectEl.options[0].text;
                selectEl.innerHTML = `<option value="">${defaultText}</option>`;
                
                pilotesTries.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.nom;
                    option.textContent = `#${p.num} - ${p.nom}`;
                    selectEl.appendChild(option);
                });
            }
        });
    }

    // On lance le remplissage immédiatement
    remplirMenusAdmin();

    // --- LOGIQUE DU BOUTON PUBLIER ---
    document.getElementById('btn-publier').onclick = () => {
        const pass = document.getElementById('admin-pass').value;
        const session = document.getElementById('type-session').value;
        
        if (pass !== "1234") return alert("Accès refusé");

        const results = {
            "1er": document.getElementById('res-1').value,
            "2e": document.getElementById('res-2').value,
            "3e": document.getElementById('res-3').value,
            "Chute": document.getElementById('res-chute').value,
            "timestamp": new Date().toISOString()
        };

        // Vérification si des champs sont vides
        if(!results["1er"] || !results["2e"] || !results["3e"]) {
            return alert("Veuillez remplir au moins le podium !");
        }

        set(ref(db, 'resultats/' + session), results)
            .then(() => {
                document.getElementById('status-msg').innerText = "✅ Résultats publiés avec succès !";
                document.getElementById('status-msg').style.color = "lime";
            })
            .catch((e) => alert("Erreur : " + e.message));
    };
</script>